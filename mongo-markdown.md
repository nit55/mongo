# What is MongoDb and its uses

## Mongo DB is a No sql Database, it

- Does not store records in the form of tables
- Collection is a Json file similar to tables of SQL
- Documents is each individual Object in the Json
- All the JSON objects need not have the same schema/Structure
- Efficient when dealing with transactional data
- Highly scalable as data can be divided among different mongo servers.
- No need of transforming the data to JSON after querying as Json is the preferred o/p format
- internally uses binary Json / bson.

# Installation of Mongo DB on windows

- download the mongo installer from the following link
- https://www.mongodb.com/try/download/community?tck=docs_server
- Install the above download using the installer.
- Create a folder called /data/db in the root folder or the C:/ drive.
- windows installs Mongo as a service so start and stop Mongo manually
  - open command prompt as administrator
  - run the command net stop mongoDB
  - this makes sure that mongo does not start automatically and we set the path for mongo.
- To run Mongo as in Mac/Linux we need to update the path variables
  - search for environment by pressing windows icon
  - Environment variables button will appear in the bottom right, click on it
  - double click on "Path"
  - add the path to the installed folder as such `C:\Program Files\MongoDB\Server\5.0\bin` and save it
- close all terminals and open a new terminal
- type in mongo and now the installed version will be seen.
- type in mongod --dbpath 'path to the data/db/ folder creted in root', needs to be set only once.
- Keep this terminal running and minimize it, this is the running server.
- open a new terminal and type on mongo.
- MongoDB has now started.

# Methods of Mongo DB

To list all DB's

```js
show dbs
```

To list all collections in a db switch to the required db using use and then show collections

```js
use dbName -> use flights;
show collections;
```

- To create a new DB

```js
use flights;
```

- this just creates a DB but is not saved until a collection and a subsequent document is entered, if not it is dropped.

```js
db.passengers.insertOne({ name: "nitin" });
```

- once inserted the db and collection are saved along with the documents inside.
- To drop a collection use

```js
db.collectionName.drop();
```

# write/Create Opertion in Mongo DB

## insertOne(data,options)

- To insert one Object/Document use insertOne()

```js
db.passengers.insertOne({ name: "nitin", age: 31 });
```

- once inserted successfully the following response will be shown

```js
{
    "acknowledged" : true,
    "insertedId" : ObjectId("62a05ad28687c579c875")
}
```

- ID's are auto generated by MongoDB, however custom ID's can be given using \_id but make sure the ID gicen is unique

```js
db.flightData.insertOne({
  arrival: "10:30",
  departure: "2:30",
  _id: "plane-1",
});
```

- The output would be as follows

```js
{ "acknowledged" : true, "insertedId" : "plane-1" }
```

- as seen from the output above the document is inserted with the custom ID.

## insertMany(data,options)

- To insert Multiple Objects use insertMany(), it accepts an array.

```js
db.passengers.insertMany([
  { name: "prasan", age: 30 },
  { name: "Lakshmi", age: 29 },
]);
```

- The output for insertMany() would be as below

```js
{
        "acknowledged" : true,
        "insertedIds" : [
                ObjectId("62a05d0c8687c579c875e"),
                ObjectId("62a05d0c8687c579c875e")
        ]
}
```

- as seen from the output the id's are auto-generated for each document, custom ID's can also be passed for each document as seen above.

# Read Operations in Mongo DB

## find(filter,options)

- find(filter,options) method returns the results in the db upto 20 elements.

pretty() makes sure the data is displayed in a formatted manner

find() without filter returns all results, pointing upto only 20 results.

```js
db.collectionName.find().pretty();
```

- Output of above snippet

```js
{
        "_id" : ObjectId("629e42fbca7bf6a925e2"),
        "name" : "Max Schwarzmueller",
        "age" : 29
}
{
        "_id" : ObjectId("629e42fbca7bf6a925e2"),
        "name" : "Manu Lorenz",
        "age" : 30
}
```

- find() with filters
- finds all the passengers with age greater than 38.

```js
db.passengerData.find({ age: { $gt: 38 } }).pretty();
```

## findOne(filter,options)

- as the name suggests used to find the first occurence of any particular document based on a filter/criteria.

```js
db.passengerData.findOne({ age: { $gt: 38 } });
```

# Update Operations in MongoDB

- Make sure to pass a filter for update else all the records in the collection will be reset with only the data passed in the update method.

## updateOne(filter,data,options)

- Filter is Mandatory to update a Record.

```js
db.passengers.updateOne({ age: 31 }, { $set: { age: 30 } });
```

- filter like greater than/lesser than also can be used to update the data

```js
db.passengers.updateOne({ age: { $lt: 31 } }, { $set: { age: 30 } });
```

- The output would be as follows

```js
{ "acknowledged" : true, "matchedCount" : 1, "modifiedCount" : 1 }
```

## updateMany(filter,data,options)

```js
db.passengerData.updateMany({ age: { $lt: 38 } }, { $set: { age: 21 } });
```

- The output is as follows

```js
{ "acknowledged" : true, "matchedCount" : 12, "modifiedCount" : 11 }
```

## replaceOne(filter,data)

- This is used to replace the entire document based on a condition

```js
db.passengers.replaceOne(
  { _id: ObjectId("629e42fbca7bf6a925e2") },
  { name: "Narayana", age: 28 }
);
```

# Delete Operations in MongoDB

## deleteOne(filter,options)

- A criteria/Filter is required for delete operations.
- We are deleting the first document we encounter in the collection.
- If filter is not applied gives an error as it is mandatory.

```js
db.passengers.deleteOne({ name: "Nitin" });
```

```js
{ "acknowledged" : true, "deletedCount" : 1 }
```

## deleteMany(filter,options)

- If no arguments are passed then all documents are deleted else the filtered items are only deleted

```js
db.passengers.deleteMany({});
```

# Cursor Object

- The find() method by default returns only 20 documents and a cursor Object
- Cursor Object consists of metaData that allows us to cycle through the result.
- The it command returns the next 20 results and the cursor Object updated and so forth we can cycle through the entire collection.
- If we need all the results in one shot we need to export it as an array as shown below.

```js
db.passengers.find().toArray();
```

- we can also loop through for a more realistic/performance based approach where cursor goes through each document using forEach.

```js
db.passengers.find().forEach((passenger) => {
  printJson(passenger);
});
```

- pretty() is also a method attached to the cursor, it works on find() but not on findOne() as findOne() does not return a cursor Object.

# Projection

- Sometimes we dont need to dispatch/display all the keys in a document, under such circumstances we can use projection.

- As the name suggests we only project/display a part of the data rather than the entire object.

- The first parameter is the filter, if empty it means all the documents in the collection.
- the second parameter (options) tells which fields to include in the output.
- By default \_id is always 1 which means it will be displayed, if not required explicitly set to 0
- For other fields it will be default 0, only the ones we set as 1 will be displayed.
- If the options parameter is not passed all the fields will be displayed.

```js
db.passengers.find({}, { name: 1, _id: 0 });
```

```js
{ "name" : "Max Schwarzmueller" }
{ "name" : "Manu Lorenz" }
{ "name" : "Chris Hayton" }
{ "name" : "Sandeep Kumar" }
{ "name" : "Maria Jones" }
{ "name" : "Alexandra Maier" }
{ "name" : "Dr. Phil Evans" }
{ "name" : "Sandra Brugge" }
{ "name" : "Elisabeth Mayr" }
{ "name" : "Frank Cube" }
{ "name" : "Karandeep Alun" }
{ "name" : "Michaela Drayer" }
{ "name" : "Bernd Hoftstadt" }
{ "name" : "Scott Tolib" }
{ "name" : "Freddy Melver" }
{ "name" : "Alexis Bohed" }
{ "name" : "Melanie Palace" }
{ "name" : "Armin Glutch" }
{ "name" : "Klaus Arber" }
{ "name" : "Gordon Black" }
```

- as seen from the above the output we have projected/displayed only the name field.
